local plrs = game:GetService("Players")
local plr = plrs.LocalPlayer
local BP = plr:WaitForChild("Backpack")
local PlrStats = plr:WaitForChild("PlayerStats")
local Stand = PlrStats:WaitForChild("Stand")
local vim = game:GetService("VirtualInputManager")
loadstring(game:HttpGet("https://raw.githubusercontent.com/zakater5/LuaRepo/main/YBA/v3.lua"))()

function SendMessage(url, message)
    local http = game:GetService("HttpService")
    local headers = {
        ["Content-Type"] = "application/json"
    }
    local data = {
        ["content"] = message
    }
    local body = http:JSONEncode(data)
    local response = request({
        Url = url,
        Method = "POST",
        Headers = headers,
        Body = body
    })
    print("Sent")
end

function SendMessageEMBED(url, embed)
    local http = game:GetService("HttpService")
    local headers = {
        ["Content-Type"] = "application/json"
    }
    local data = {
        ["embeds"] = {
            {
                ["title"] = embed.title,
                ["description"] = embed.description,
                ["color"] = embed.color,
                ["fields"] = embed.fields,
                ["footer"] = {
                    ["text"] = embed.footer.text
                }
            }
        }
    }
    local body = http:JSONEncode(data)
    local response = request({
        Url = url,
        Method = "POST",
        Headers = headers,
        Body = body
    })
    print("Sent")
end

function StatPoints()
    local ohString1 = "LearnSkill"
    local ohTable2 = {
        ["Skill"] = "Worthiness II",
        ["SkillTreeType"] = "Character"
    }

    workspace.Living[plr.Name].RemoteFunction:InvokeServer(ohString1, ohTable2)
end

function Roka()
    local arrow = BP:FindFirstChild("Rokakaka") -- Find the tool instance
    if arrow then
        plr.Character:WaitForChild("Humanoid"):EquipTool(arrow) -- Equip the tool
        arrow:Activate()
        workspace.Living[plr.Name]:WaitForChild("HumanoidRootPart").CFrame = CFrame.new(-246, 284, 308)
        task.wait(0.7)
        vim:SendMouseButtonEvent(0, 0, 0, true, game, 1) task.wait() vim:SendMouseButtonEvent(0, 0, 0, false, game, 1)
        
        local PLRGUI = plr:WaitForChild("PlayerGui")
        local Option1 = PLRGUI:WaitForChild("DialogueGui"):WaitForChild("Frame"):WaitForChild("Options"):WaitForChild("Option1").TextButton

        for _,connection in pairs(getconnections(Option1.MouseButton1Click)) do
            connection:Fire()
        end
    else
        warn("Rokakaka not found in the backpack")
    end
end

function Arrow()
    -- Redefine variables after using Rokakaka
    BP = plr:WaitForChild("Backpack")

    local arrow = BP:FindFirstChild("Mysterious Arrow") -- Find the tool instance
    if arrow then
        workspace.Living[plr.Name]:WaitForChild("Humanoid"):EquipTool(arrow) -- Equip the tool     
        arrow:Activate()
        workspace.Living[plr.Name]:WaitForChild("HumanoidRootPart").CFrame = CFrame.new(-246, 284, 308)
        task.wait(0.7)
        vim:SendMouseButtonEvent(0, 0, 0, true, game, 1) task.wait() vim:SendMouseButtonEvent(0, 0, 0, false, game, 1)
        
        local PLRGUI = plr:WaitForChild("PlayerGui")
        local Option1 = PLRGUI:WaitForChild("DialogueGui"):WaitForChild("Frame"):WaitForChild("Options"):WaitForChild("Option1").TextButton

        for _,connection in pairs(getconnections(Option1.MouseButton1Click)) do
            connection:Fire()
        end

        local PlrStats = plr:WaitForChild("PlayerStats")
        local Stand = PlrStats:WaitForChild("Stand")

        -- Wait until Stand value is not "None"
        while Stand.Value == "None" do
            task.wait(0.5)
        end

        local gui = plr.PlayerGui
        local Main = gui:WaitForChild("HUD"):WaitForChild("Main")
        local Stands = Main.Frames:WaitForChild("Stands")
        local ScrollingFrame = Stands:WaitForChild("ScrollingFrame")
        local Equipped = ScrollingFrame:WaitForChild("Equipped")

        local IsShiny
        local ShinyP

        if Equipped:FindFirstChild("Shiny") then
            IsShiny = "Shiny"
            ShinyP = "Yes"
        else
            IsShiny = "Nonshiny"
            ShinyP = "No"
        end

        -- Notification
        local embed = {
            ["title"] = "Your Bizzare Adventure - "..game.Players.LocalPlayer.DisplayName,
            ["description"] = "Stand Farm",
            ["color"] = 65280,
            ["fields"] = {
                {
                    ["name"] = "You got a Stand!",
                    ["value"] = "Stand: " .. Stand.Value .. "\n Shiny: " .. ShinyP .. "\n Skin Name: ".. Equipped:FindFirstChild("TextLabel").Text
                },
            },
            ["footer"] = {
                ["text"] = ""
            }
        }

        if ShinyP == "Yes" then
            SendMessage(getgenv().webhook, "@everyone")
        end

        SendMessageEMBED(getgenv().webhook, embed)

        -- Notification
        local Notifications = loadstring(game:HttpGet("https://raw.githubusercontent.com/tacolift/notification-library/main/library.lua"))()
        Notifications.Create("Stand", "You got a "..IsShiny.. " " .. Stand.Value, 1, Color3.fromRGB(255, 255, 255))
        task.wait(3)
        Notifications.Clear()
    else
        warn("Mysterious Arrow not found in the backpack")
    end
end

-- Execute Roka function
local gui = plr.PlayerGui
local Main = gui:WaitForChild("HUD"):WaitForChild("Main")
local Stands = Main.Frames:WaitForChild("Stands")
local ScrollingFrame = Stands:WaitForChild("ScrollingFrame")
local Equipped = ScrollingFrame:WaitForChild("Equipped")

while not Equipped:FindFirstChild("Shiny") or getgenv().Farm == true do
    if Stand.Value == "None" then
        StatPoints()
        task.wait(1)
        Arrow()
    else
        Roka()
        task.wait(5)
    
        -- Execute StatPoints function
        StatPoints()
    
        -- Wait a moment to ensure StatPoints completes
        task.wait(1)
    
        -- Execute Arrow function
        Arrow()
    end
end
